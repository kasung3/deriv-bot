(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{58761:function(e,t,s){Promise.resolve().then(s.bind(s,77399))},77399:function(e,t,s){"use strict";s.d(t,{default:function(){return U}});var a=s(15444),i=s(89300),n=s(75762),l=s(12817),r=s(1946),c=s(64670),o=s(97480),d=s(64990),m=s(56603),x=s(19827),u=s(99983),h=s(6488),p=s(83648);let g=[{symbol:"R_10",name:"Volatility 10 Index"},{symbol:"R_25",name:"Volatility 25 Index"},{symbol:"R_50",name:"Volatility 50 Index"},{symbol:"R_75",name:"Volatility 75 Index"},{symbol:"R_100",name:"Volatility 100 Index"},{symbol:"1HZ10V",name:"Volatility 10 (1s) Index"},{symbol:"1HZ25V",name:"Volatility 25 (1s) Index"},{symbol:"1HZ50V",name:"Volatility 50 (1s) Index"},{symbol:"1HZ75V",name:"Volatility 75 (1s) Index"},{symbol:"1HZ100V",name:"Volatility 100 (1s) Index"}];function y(e,t){return e?.length<t?0:e.slice(-t).reduce((e,t)=>e+t,0)/t}var b=s(70691),f=s(52429),N=s(25422),j=s(66124),v=s(88382);function S({tokens:e,onUpdate:t,disabled:s}){let[n,l]=(0,i.useState)(e),[c,o]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),[x,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[S,k]=(0,i.useState)(!1),w=async e=>{let s="demo"===e?u:p,a="demo"===e?y:k,i="demo"===e?n.demo:n.live;s(!0);try{(await fetch("/api/tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tokenType:e,token:i})})).ok&&(t(n),a(!0),setTimeout(()=>a(!1),2e3))}catch(e){console.error("Failed to save token:",e)}finally{s(!1)}};return(0,a.jsxs)("div",{className:"card space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"w-5 h-5 text-fuchsia-400"}),"API Tokens"]}),s&&(0,a.jsx)("div",{className:"bg-yellow-600/20 border border-yellow-600/30 text-yellow-400 px-3 py-2 rounded-lg text-sm",children:"Stop trading to modify tokens"}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Get your API tokens from"," ",(0,a.jsx)("a",{href:"https://app.deriv.com/account/api-token",target:"_blank",rel:"noopener noreferrer",className:"text-fuchsia-400 hover:text-fuchsia-300",children:"Deriv Account Settings"})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Demo Account Token"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:c?"text":"password",value:n?.demo??"",onChange:e=>l(t=>({...t,demo:e.target.value})),className:"input-field pr-20",placeholder:"Enter demo API token",disabled:s}),(0,a.jsx)("button",{onClick:()=>o(!c),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-2",children:c?(0,a.jsx)(f.Z,{className:"w-5 h-5"}):(0,a.jsx)(N.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("button",{onClick:()=>w("demo"),disabled:s||x||!n?.demo,className:"btn-primary w-full mt-3 flex items-center justify-center gap-2 text-sm py-2",children:x?(0,a.jsx)(r.Z,{className:"w-4 h-4 animate-spin"}):g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"})," Saved!"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{className:"w-4 h-4"})," Save Demo Token"]})})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-4 border border-red-900/30",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-red-400 mb-2",children:"Live Account Token"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:d?"text":"password",value:n?.live??"",onChange:e=>l(t=>({...t,live:e.target.value})),className:"input-field pr-20 border-red-900/50",placeholder:"Enter live API token",disabled:s}),(0,a.jsx)("button",{onClick:()=>m(!d),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-2",children:d?(0,a.jsx)(f.Z,{className:"w-5 h-5"}):(0,a.jsx)(N.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"bg-red-900/20 text-red-400 text-xs p-2 rounded mt-2",children:"⚠️ Use with caution. Real money at risk."}),(0,a.jsx)("button",{onClick:()=>w("live"),disabled:s||h||!n?.live,className:"bg-red-600 hover:bg-red-700 text-white w-full mt-3 py-2 rounded-lg font-medium flex items-center justify-center gap-2 text-sm transition-colors disabled:opacity-50",children:h?(0,a.jsx)(r.Z,{className:"w-4 h-4 animate-spin"}):S?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"})," Saved!"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{className:"w-4 h-4"})," Save Live Token"]})})]})]})}function k({settings:e,onUpdate:t,disabled:s}){let[n,l]=(0,i.useState)(e),[c,o]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),x=async()=>{o(!0),await t(n),o(!1),m(!0),setTimeout(()=>m(!1),2e3)},u=(e,t)=>{l(s=>({...s,[e]:t}))};return(0,a.jsxs)("div",{className:"card space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"w-5 h-5 text-fuchsia-400"}),"Trading Settings"]}),s&&(0,a.jsx)("div",{className:"bg-yellow-600/20 border border-yellow-600/30 text-yellow-400 px-3 py-2 rounded-lg text-sm",children:"Stop trading to modify settings"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-300",children:"Stake & Martingale"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Initial Stake ($)"}),(0,a.jsx)("input",{type:"number",value:n?.initialStake??1,onChange:e=>u("initialStake",parseFloat(e.target.value)||1),className:"input-field",min:"0.01",step:"0.01",disabled:s})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Martingale Factor"}),(0,a.jsx)("input",{type:"number",value:n?.martingaleFactor??2,onChange:e=>u("martingaleFactor",parseFloat(e.target.value)||2),className:"input-field",min:"1",step:"0.1",disabled:s})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"ATR Threshold"}),(0,a.jsx)("input",{type:"number",value:n?.atrThreshold??5e-4,onChange:e=>u("atrThreshold",parseFloat(e.target.value)||5e-4),className:"input-field",min:"0",step:"0.0001",disabled:s})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-300",children:"Risk Management"}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Max Consecutive Losses"}),(0,a.jsx)("button",{onClick:()=>u("maxConsecutiveLossesEnabled",!n?.maxConsecutiveLossesEnabled),disabled:s,className:`toggle-switch ${n?.maxConsecutiveLossesEnabled?"active":""}`})]}),n?.maxConsecutiveLossesEnabled&&(0,a.jsx)("input",{type:"number",value:n?.maxConsecutiveLosses??5,onChange:e=>u("maxConsecutiveLosses",parseInt(e.target.value)||5),className:"input-field mt-2",min:"1",disabled:s})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Max Stake Cap ($)"}),(0,a.jsx)("button",{onClick:()=>u("maxStakeEnabled",!n?.maxStakeEnabled),disabled:s,className:`toggle-switch ${n?.maxStakeEnabled?"active":""}`})]}),n?.maxStakeEnabled&&(0,a.jsx)("input",{type:"number",value:n?.maxStake??100,onChange:e=>u("maxStake",parseFloat(e.target.value)||100),className:"input-field mt-2",min:"1",step:"1",disabled:s})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Daily Loss Limit ($)"}),(0,a.jsx)("button",{onClick:()=>u("dailyLossLimitEnabled",!n?.dailyLossLimitEnabled),disabled:s,className:`toggle-switch ${n?.dailyLossLimitEnabled?"active":""}`})]}),n?.dailyLossLimitEnabled&&(0,a.jsx)("input",{type:"number",value:n?.dailyLossLimit??50,onChange:e=>u("dailyLossLimit",parseFloat(e.target.value)||50),className:"input-field mt-2",min:"1",step:"1",disabled:s})]})]}),(0,a.jsx)("button",{onClick:x,disabled:s||c,className:"btn-primary w-full flex items-center justify-center gap-2",children:c?(0,a.jsx)(r.Z,{className:"w-5 h-5 animate-spin"}):d?"Saved!":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{className:"w-5 h-5"})," Save Settings"]})})]})}var w=s(4464),T=s(18218),C=s(70362),P=s(16142);function L({botState:e,settings:t}){let s=g.find(e=>e.symbol===t?.selectedMarket)?.name||"Unknown";return(0,a.jsxs)("div",{className:"card space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-fuchsia-400"}),"Trading Status"]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Status"}),(0,a.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${{STOPPED:"bg-gray-600",RUNNING:"bg-green-500",PAUSED:"bg-yellow-500"}[e?.status??"STOPPED"]} text-white`,children:e?.status??"STOPPED"})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),"Balance"]}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-white",children:["$",(e?.balance??0).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"Session P/L"}),(0,a.jsxs)("div",{className:`text-lg font-semibold ${(e?.sessionProfit??0)>=0?"text-green-400":"text-red-400"}`,children:[(e?.sessionProfit??0)>=0?"+":"","$",(e?.sessionProfit??0).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"All-Time P/L"}),(0,a.jsxs)("div",{className:`text-lg font-semibold ${(e?.allTimeProfit??0)>=0?"text-green-400":"text-red-400"}`,children:[(e?.allTimeProfit??0)>=0?"+":"","$",(e?.allTimeProfit??0).toFixed(2)]})]})]}),e?.currentTrade&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-fuchsia-900/30 border border-fuchsia-600/30 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-fuchsia-300 text-sm font-medium mb-2",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),"Active Trade"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Direction:"}),(0,a.jsx)("span",{className:`ml-2 font-medium ${e.currentTrade?.direction==="RISE"?"text-green-400":"text-red-400"}`,children:e.currentTrade?.direction??"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Stake:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium text-white",children:["$",(e.currentTrade?.stake??0).toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-gray-400 flex items-center gap-2",children:[(0,a.jsx)(T.Z,{className:"w-4 h-4"}),"Current Stake"]}),(0,a.jsxs)("span",{className:"font-medium text-white",children:["$",(e?.currentStake??1).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-gray-400 flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4"}),"Consecutive Losses"]}),(0,a.jsx)("span",{className:`font-medium ${(e?.consecutiveLosses??0)>=3?"text-red-400":"text-white"}`,children:e?.consecutiveLosses??0})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-gray-400 flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"w-4 h-4"}),"Market"]}),(0,a.jsx)("span",{className:"font-medium text-white text-right",children:s})]})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-2",children:"Market Condition"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium ${e?.marketCondition?.trending?"bg-green-600/30 text-green-400":"bg-yellow-600/30 text-yellow-400"}`,children:e?.marketCondition?.trending?"Trending":"Sideways"}),(0,a.jsxs)("span",{className:`px-2 py-1 rounded text-xs font-medium ${e?.marketCondition?.volatility==="HIGH"?"bg-fuchsia-600/30 text-fuchsia-400":"bg-gray-600/30 text-gray-400"}`,children:[e?.marketCondition?.volatility??"LOW"," Volatility"]})]})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Indicators"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:"SMA 5"}),(0,a.jsx)("div",{className:"font-medium text-green-400",children:(e?.sma5??0).toFixed(5)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:"SMA 6"}),(0,a.jsx)("div",{className:"font-medium text-red-400",children:(e?.sma6??0).toFixed(5)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:"ATR"}),(0,a.jsx)("div",{className:"font-medium text-fuchsia-400",children:(e?.atr??0).toFixed(6)})]})]})]}),(0,a.jsxs)("div",{className:"bg-[#252542] rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"Last Signal"}),(0,a.jsx)("div",{className:"text-sm text-white",children:e?.lastSignal??"Waiting..."})]})]})}var E=s(62492),I=s(48967);function R({trades:e}){let t=e=>{try{return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}},s=e=>g.find(t=>t.symbol===e)?.name?.split(" ").slice(0,2).join(" ")||e;return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[(0,a.jsx)(E.Z,{className:"w-5 h-5 text-fuchsia-400"}),"Recent Trades"]}),e&&0!==e.length?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-gray-400 text-left border-b border-gray-700",children:[(0,a.jsx)("th",{className:"pb-2 font-medium",children:"Time"}),(0,a.jsx)("th",{className:"pb-2 font-medium",children:"Market"}),(0,a.jsx)("th",{className:"pb-2 font-medium",children:"Direction"}),(0,a.jsx)("th",{className:"pb-2 font-medium",children:"Stake"}),(0,a.jsx)("th",{className:"pb-2 font-medium text-right",children:"P/L"})]})}),(0,a.jsx)("tbody",{children:(e??[]).map((e,i)=>(0,a.jsxs)(l.E.tr,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*i},className:`border-b border-gray-800 ${e?.result==="WIN"?"bg-green-900/10":e?.result==="LOSS"?"bg-red-900/10":""}`,children:[(0,a.jsx)("td",{className:"py-3 text-gray-300",children:t(e?.entryTime??new Date)}),(0,a.jsx)("td",{className:"py-3 text-gray-300",children:s(e?.market??"")}),(0,a.jsx)("td",{className:"py-3",children:(0,a.jsxs)("span",{className:`flex items-center gap-1 ${e?.direction==="RISE"?"text-green-400":"text-red-400"}`,children:[e?.direction==="RISE"?(0,a.jsx)(c.Z,{className:"w-4 h-4"}):(0,a.jsx)(I.Z,{className:"w-4 h-4"}),e?.direction??"N/A"]})}),(0,a.jsxs)("td",{className:"py-3 text-gray-300",children:["$",(e?.stake??0).toFixed(2)]}),(0,a.jsx)("td",{className:`py-3 text-right font-medium ${e?.result==="WIN"?"text-green-400":e?.result==="LOSS"?"text-red-400":"text-yellow-400"}`,children:e?.result==="PENDING"?"Pending...":`${(e?.profit??0)>=0?"+":""}$${(e?.profit??0).toFixed(2)}`})]},e?.id||i))})]})}):(0,a.jsx)("div",{className:"text-center text-gray-400 py-8",children:"No trades yet. Start the bot to begin trading."})]})}var Z=s(17839),$=s(21753),O=s(14373);let _=(0,Z.default)(()=>Promise.all([s.e(534),s.e(511)]).then(s.bind(s,83511)),{loadableGenerated:{webpack:()=>[83511]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"h-full flex items-center justify-center text-gray-400",children:"Loading charts..."})});function F({candles:e,sma5:t,sma6:s,stats:i,trades:n}){return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card col-span-1 md:col-span-2",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[(0,a.jsx)($.Z,{className:"w-5 h-5 text-fuchsia-400"}),"Price Chart (1-Min Candles)"]}),(0,a.jsx)("div",{className:"h-[250px]",children:(0,a.jsx)(_,{type:"candles",candles:e??[],sma5:t??0,sma6:s??0})})]}),(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-fuchsia-400"}),"Balance History"]}),(0,a.jsx)("div",{className:"h-[200px]",children:(0,a.jsx)(_,{type:"balance",balanceHistory:i?.balanceHistory??[]})})]}),(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[(0,a.jsx)(O.Z,{className:"w-5 h-5 text-fuchsia-400"}),"Win/Loss Ratio"]}),(0,a.jsx)("div",{className:"h-[200px]",children:(0,a.jsx)(_,{type:"winLoss",wins:i?.wins??0,losses:i?.losses??0,winRate:i?.winRate??0})})]})]})}var A=s(59335),M=s(33485);function D({open:e,message:t,onConfirm:s,onCancel:i}){return(0,a.jsx)(A.M,{children:e&&(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:i,children:(0,a.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-[#1a1a2e] rounded-xl p-6 max-w-md w-full shadow-xl border border-fuchsia-900/30",children:[(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-2 bg-fuchsia-600/20 rounded-lg",children:(0,a.jsx)(C.Z,{className:"w-6 h-6 text-fuchsia-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"Confirm Action"}),(0,a.jsx)("p",{className:"text-gray-400",children:t||"Are you sure?"})]}),(0,a.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-white",children:(0,a.jsx)(M.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:i,className:"flex-1 py-2 px-4 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-medium transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:s,className:"flex-1 btn-primary",children:"Confirm"})]})]})})})}function U(){let{data:e,status:t}=(0,n.useSession)()||{},[s,b]=(0,i.useState)(!1),[f,N]=(0,i.useState)(null),[j,v]=(0,i.useState)({demo:"",live:""}),[w,T]=(0,i.useState)({status:"STOPPED",balance:0,sessionProfit:0,allTimeProfit:0,consecutiveLosses:0,currentStake:1,currentTrade:null,marketCondition:{trending:!1,volatility:"LOW"},sma5:0,sma6:0,atr:0,lastSignal:"Waiting for data..."}),[C,P]=(0,i.useState)([]),[E,I]=(0,i.useState)([]),[Z,$]=(0,i.useState)(!0),[O,_]=(0,i.useState)({open:!1,action:"",message:""}),[A,M]=(0,i.useState)("status"),[U,G]=(0,i.useState)({allTimeProfit:0,sessionProfit:0,wins:0,losses:0,winRate:0,balanceHistory:[]}),W=(0,i.useRef)(null),V=(0,i.useRef)([]),J=(0,i.useRef)(w),H=(0,i.useRef)(f),z=(0,i.useRef)(1),B=(0,i.useRef)(null),q=(0,i.useRef)(0);(0,i.useEffect)(()=>{J.current=w},[w]),(0,i.useEffect)(()=>{H.current=f,f&&(z.current=f.initialStake)},[f]),(0,i.useEffect)(()=>{V.current=E},[E]),(0,i.useEffect)(()=>{b(!0)},[]),(0,i.useEffect)(()=>{(async()=>{try{let[e,t,s,a]=await Promise.all([fetch("/api/settings"),fetch("/api/tokens"),fetch("/api/trades?limit=10"),fetch("/api/stats")]);if(e.ok){let t=await e.json();N(t),T(e=>({...e,currentStake:t.initialStake})),z.current=t.initialStake}if(t.ok&&v(await t.json()),s.ok&&P(await s.json()),a.ok){let e=await a.json();G(e),T(t=>({...t,allTimeProfit:e.allTimeProfit,sessionProfit:e.sessionProfit}))}}catch(e){console.error("Failed to load data:",e)}finally{$(!1)}})()},[]);let K=(0,i.useCallback)(()=>{if(!f||!j)return;let e="demo"===f.accountType?j.demo:j.live;if(!e){T(e=>({...e,lastSignal:"No API token configured for "+f.accountType+" account"}));return}W.current?.readyState===WebSocket.OPEN&&W.current.close();let t=new WebSocket("wss://ws.binaryws.com/websockets/v3?app_id=1089");W.current=t,t.onopen=()=>{t.send(JSON.stringify({authorize:e}))},t.onmessage=e=>{Q(JSON.parse(e.data))},t.onerror=e=>{console.error("WebSocket error:",e),T(e=>({...e,lastSignal:"Connection error"}))},t.onclose=()=>{"RUNNING"===J.current.status&&setTimeout(K,3e3)}},[f,j]),Q=(0,i.useCallback)(e=>{let t=e?.msg_type;if(e.error){console.error("Deriv API error:",e.error),T(t=>({...t,lastSignal:`Error: ${e.error.message||"Unknown"}`}));return}switch(t){case"authorize":T(t=>({...t,balance:e.authorize?.balance||0})),W.current?.send(JSON.stringify({balance:1,subscribe:1}));let s=H.current?.selectedMarket||"R_10";W.current?.send(JSON.stringify({ticks_history:s,count:20,end:"latest",granularity:60,style:"candles",subscribe:1}));break;case"balance":T(t=>({...t,balance:e.balance?.balance||t.balance}));break;case"candles":if(e.candles?.length){let t=e.candles.map(e=>({epoch:e.epoch,open:parseFloat(e.open),high:parseFloat(e.high),low:parseFloat(e.low),close:parseFloat(e.close)}));I(t),V.current=t,t.length>0&&(q.current=t[t.length-1].epoch),X()}break;case"ohlc":if(e.ohlc){let t={epoch:e.ohlc.epoch,open:parseFloat(e.ohlc.open),high:parseFloat(e.ohlc.high),low:parseFloat(e.ohlc.low),close:parseFloat(e.ohlc.close)};if(t.epoch>q.current){q.current=t.epoch;let e=[...V.current.slice(-19),t];I(e),V.current=e,X()}else{let e=[...V.current];e.length>0&&(e[e.length-1]=t,I(e),V.current=e)}}break;case"buy":if(e.buy){B.current=e.buy.contract_id?.toString();let t={id:"",contractId:e.buy.contract_id?.toString(),market:H.current?.selectedMarket||"R_10",direction:J.current.currentTrade?.direction||"RISE",stake:e.buy.buy_price||z.current,entryTime:new Date,result:"PENDING",accountType:H.current?.accountType||"demo",sma5:J.current.sma5,sma6:J.current.sma6,atr:J.current.atr};T(e=>({...e,currentTrade:t,lastSignal:`Trade placed: ${t.direction} at $${t.stake}`})),ee(t),W.current?.send(JSON.stringify({proposal_open_contract:1,contract_id:e.buy.contract_id,subscribe:1}))}break;case"proposal_open_contract":if(e.proposal_open_contract?.status==="sold"||e.proposal_open_contract?.is_sold){var a,i,n,l,r,c;let t;let s=e.proposal_open_contract,o=s.profit||0,d=o>0;et(s.contract_id?.toString(),d?"WIN":"LOSS",o,s.exit_tick||0);let m=d?0:J.current.consecutiveLosses+1,x=(a=d?"WIN":"LOSS",i=z.current,n=H.current?.initialStake||1,l=H.current?.martingaleFactor||2,r=H.current?.maxStake||100,c=H.current?.maxStakeEnabled||!0,t=n,"LOSS"===a&&(t=i*l),c&&t>r&&(t=r),Math.round(100*t)/100);z.current=d?H.current?.initialStake||1:x,T(e=>({...e,consecutiveLosses:m,currentStake:z.current,currentTrade:null,sessionProfit:e.sessionProfit+o,allTimeProfit:e.allTimeProfit+o,lastSignal:`Trade ${d?"WON":"LOST"}: ${o>=0?"+":""}$${o.toFixed(2)}`})),B.current=null,ea(m,o),es()}}},[]),X=(0,i.useCallback)(()=>{if("RUNNING"!==J.current.status||B.current)return;if(V.current.length<10){T(e=>({...e,lastSignal:`Waiting for candles (${V.current.length}/10)`}));return}let e=V.current.map(e=>e.close),t=y(e,5),s=y(e,6),a=function(e,t=14){if(!e||e.length<t+1)return 0;let s=[];for(let t=1;t<e.length;t++){let a=e[t],i=e[t-1],n=Math.max(a.high-a.low,Math.abs(a.high-i.close),Math.abs(a.low-i.close));s.push(n)}let a=s.slice(-t);return a.reduce((e,t)=>e+t,0)/a.length}(V.current,14),i=H.current?.atrThreshold||5e-4;T(e=>({...e,sma5:t,sma6:s,atr:a,marketCondition:{trending:Math.abs(t-s)>i,volatility:a>i?"HIGH":"LOW"}}));let{direction:n,reason:l}=a<i?{direction:null,reason:"Low volatility - ATR below threshold"}:t>s?{direction:"RISE",reason:"SMA5 crossed above SMA6 - Bullish"}:t<s?{direction:"FALL",reason:"SMA5 crossed below SMA6 - Bearish"}:{direction:null,reason:"No clear signal - SMAs equal"};T(e=>({...e,lastSignal:l})),n&&W.current?.readyState===WebSocket.OPEN&&Y(n)},[]),Y=(0,i.useCallback)(e=>{let t=H.current?.selectedMarket||"R_10",s=z.current;T(a=>({...a,currentTrade:{id:"",market:t,direction:e,stake:s,entryTime:new Date,result:"PENDING",accountType:H.current?.accountType||"demo"}})),W.current?.send(JSON.stringify({buy:1,price:s,parameters:{contract_type:"RISE"===e?"CALL":"PUT",symbol:t,duration:1,duration_unit:"m",basis:"stake",amount:s,currency:"USD"}}))},[]),ee=async e=>{try{let t=await fetch("/api/trades",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();T(t=>({...t,currentTrade:t.currentTrade?{...t.currentTrade,id:e.id}:null}))}}catch(e){console.error("Failed to save trade:",e)}},et=async(e,t,s,a)=>{let i=J.current.currentTrade;if(i?.id)try{await fetch(`/api/trades/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({result:t,profit:s,exitPrice:a,exitTime:new Date})})}catch(e){console.error("Failed to update trade:",e)}},es=async()=>{try{let e=await fetch("/api/trades?limit=10");e.ok&&P(await e.json())}catch(e){console.error("Failed to refresh trades:",e)}},ea=(0,i.useCallback)((e,t)=>{let s=H.current;if(s){if(s.maxConsecutiveLossesEnabled&&e>=s.maxConsecutiveLosses){er(),T(e=>({...e,lastSignal:`Stopped: Max consecutive losses (${s.maxConsecutiveLosses}) reached`}));return}s.dailyLossLimitEnabled&&J.current.sessionProfit<=-s.dailyLossLimit&&(er(),T(e=>({...e,lastSignal:`Stopped: Daily loss limit ($${s.dailyLossLimit}) reached`})))}},[]),ei=(0,i.useCallback)(()=>{if(!j.demo&&!j.live){T(e=>({...e,lastSignal:"Please configure API tokens first"}));return}T(e=>({...e,status:"RUNNING",lastSignal:"Starting..."})),K()},[j,K]),en=(0,i.useCallback)(()=>{T(e=>({...e,status:"PAUSED",lastSignal:"Trading paused"}))},[]),el=(0,i.useCallback)(()=>{T(e=>({...e,status:"RUNNING",lastSignal:"Resuming..."}))},[]),er=(0,i.useCallback)(()=>{T(e=>({...e,status:"STOPPED",lastSignal:"Trading stopped",currentTrade:null})),z.current=H.current?.initialStake||1,T(e=>({...e,currentStake:z.current,consecutiveLosses:0})),W.current&&(W.current.close(),W.current=null)},[]),ec=async e=>{f&&(N({...f,selectedMarket:e}),await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedMarket:e})}),"RUNNING"===w.status&&W.current&&(W.current.send(JSON.stringify({forget_all:"candles"})),W.current.send(JSON.stringify({ticks_history:e,count:20,end:"latest",granularity:60,style:"candles",subscribe:1}))))};return!s||Z?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#0f0f1a]",children:(0,a.jsx)(r.Z,{className:"w-8 h-8 animate-spin text-fuchsia-500"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-[#0f0f1a]",children:[(0,a.jsx)("header",{className:"sticky top-0 z-50 bg-[#0f0f1a]/90 backdrop-blur-sm border-b border-fuchsia-900/30",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.Z,{className:"w-8 h-8 text-fuchsia-500"}),(0,a.jsx)("span",{className:"text-xl font-bold gradient-text",children:"Deriv Trading Bot"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-gray-400 text-sm",children:["Welcome, ",e?.user?.name||"Trader"]}),(0,a.jsxs)("button",{onClick:()=>(0,n.signOut)({callbackUrl:"/login"}),className:"flex items-center gap-2 text-gray-400 hover:text-fuchsia-400 transition-colors",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Logout"})]})]})]})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,a.jsx)(l.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"card mb-6",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Market"}),(0,a.jsx)("select",{value:f?.selectedMarket||"R_10",onChange:e=>ec(e.target.value),className:"input-field py-2 min-w-[200px]",disabled:"RUNNING"===w.status,children:g.map(e=>(0,a.jsx)("option",{value:e.symbol,children:e.name},e.symbol))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Account"}),(0,a.jsxs)("div",{className:"flex bg-[#252542] rounded-lg p-1",children:[(0,a.jsx)("button",{onClick:async()=>{f&&"RUNNING"!==w.status&&(N({...f,accountType:"demo"}),await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountType:"demo"})}))},className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${f?.accountType==="demo"?"bg-fuchsia-600 text-white":"text-gray-400 hover:text-white"}`,children:"Demo"}),(0,a.jsx)("button",{onClick:async()=>{f&&"RUNNING"!==w.status&&(N({...f,accountType:"live"}),await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountType:"live"})}))},className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${f?.accountType==="live"?"bg-red-600 text-white":"text-gray-400 hover:text-white"}`,children:"Live"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["STOPPED"===w.status&&(0,a.jsxs)("button",{onClick:()=>_({open:!0,action:"start",message:`Start trading on ${f?.accountType?.toUpperCase()} account with ${g.find(e=>e.symbol===f?.selectedMarket)?.name}?`}),className:"btn-primary flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"})," Start"]}),"RUNNING"===w.status&&(0,a.jsxs)("button",{onClick:en,className:"bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5"})," Pause"]}),"PAUSED"===w.status&&(0,a.jsxs)("button",{onClick:el,className:"btn-primary flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"})," Resume"]}),"STOPPED"!==w.status&&(0,a.jsxs)("button",{onClick:()=>_({open:!0,action:"stop",message:"Stop trading? This will reset your current stake and consecutive losses count."}),className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5"})," Stop"]})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,a.jsx)("div",{className:"flex bg-[#1a1a2e] rounded-lg p-1",children:[{key:"status",label:"Status",icon:u.Z},{key:"settings",label:"Settings",icon:h.Z},{key:"tokens",label:"API Tokens",icon:p.Z}].map(({key:e,label:t,icon:s})=>(0,a.jsxs)("button",{onClick:()=>M(e),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-md text-sm font-medium transition-colors ${A===e?"bg-fuchsia-600 text-white":"text-gray-400 hover:text-white"}`,children:[(0,a.jsx)(s,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:t})]},e))}),(0,a.jsxs)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.2},children:["status"===A&&(0,a.jsx)(L,{botState:w,settings:f}),"settings"===A&&f&&(0,a.jsx)(k,{settings:f,onUpdate:async e=>{N(e),await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},disabled:"STOPPED"!==w.status}),"tokens"===A&&(0,a.jsx)(S,{tokens:j,onUpdate:e=>v(e),disabled:"STOPPED"!==w.status})]},A)]}),(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsx)(F,{candles:E,sma5:w.sma5,sma6:w.sma6,stats:U,trades:C}),(0,a.jsx)(R,{trades:C})]})]})]}),(0,a.jsx)(D,{open:O.open,message:O.message,onConfirm:()=>{switch(O.action){case"start":ei();break;case"stop":er()}_({open:!1,action:"",message:""})},onCancel:()=>_({open:!1,action:"",message:""})})]})}}},function(e){e.O(0,[762,59,217,386,156,744],function(){return e(e.s=58761)}),_N_E=e.O()}]);